@using DocuNet.Web.Constants
@using Microsoft.AspNetCore.Components.Authorization
@rendermode InteractiveServer

<MudDialogProvider />
<MudPopoverProvider />
<MudSnackbarProvider />
<MudThemeProvider @bind-IsDarkMode="@_isDarkMode" />

<MudLayout>
    <MudAppBar Elevation="1">
        <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="@_toggleLeftDrawer"/>
        <MudSpacer/>
        <MudText Typo="Typo.h6">DocuNet</MudText>
        <MudSpacer/>
        <MudIconButton Icon="@Icons.Material.Filled.Person" Color="Color.Inherit" Edge="Edge.End" OnClick="_toggleRightDrawer"/>
    </MudAppBar>
    <MudDrawer Variant="DrawerVariant.Temporary" @bind-Open="@_leftDrawerIsOpen" Elevation="1">
        <MudDrawerHeader>
            <MudNavLink Typo="Typo.h6">Zapbridge</MudNavLink>
        </MudDrawerHeader>
        <MudNavMenu>
            <MudNavLink Match="NavLinkMatch.All" Href="/" Icon="@Icons.Material.Filled.Home">Início</MudNavLink>

            <AuthorizeView>
                <Authorized>
                    
                </Authorized>
            </AuthorizeView>
            <AuthorizeView Roles="@SystemRoles.SystemAdministrator">
                <Authorized>
                    <MudNavGroup Title="Sistema" Icon="@Icons.Material.Filled.Settings" Expanded="false">
                        <MudNavLink Match="NavLinkMatch.All" Href="/users" Icon="@Icons.Material.Filled.People">Usuários</MudNavLink>
                        <MudNavLink Match="NavLinkMatch.All" Href="/organizations" Icon="@Icons.Material.Filled.Business">Organizações</MudNavLink>
                    </MudNavGroup>
                </Authorized>
            </AuthorizeView>
            <MudSwitch @bind-Value="_isDarkMode" UncheckedColor="@Color.Dark" Color="@Color.Primary">Modo Escuro</MudSwitch>
        </MudNavMenu>
    </MudDrawer>
    <MudDrawer Anchor="Anchor.End" Variant="DrawerVariant.Temporary" @bind-Open="@_rightDrwerIsOpen" Elevation="1">
        <MudDrawerHeader>
            <MudText Typo="Typo.h6">Minha conta</MudText>
        </MudDrawerHeader>
        <MudNavMenu>
            <AuthorizeView>
                <Authorized>
                    <MudNavLink OnClick="HandleLogout" Icon="@Icons.Material.Filled.Logout">Sair</MudNavLink>
                </Authorized>
                <NotAuthorized>
                    <MudNavLink Match="NavLinkMatch.All" Href="account/login">Entrar</MudNavLink>
                </NotAuthorized>
            </AuthorizeView>
        </MudNavMenu>
    </MudDrawer>
</MudLayout>

@code {
    [Inject] NavigationManager NavigationManager { get; set; } =default!;
    //[Inject] SignInManager<User> SignInManager { get; set; } = default!;
    private bool _isDarkMode = true;
    bool _leftDrawerIsOpen;
    bool _rightDrwerIsOpen;

    void _toggleLeftDrawer()
    {
        _leftDrawerIsOpen = !_leftDrawerIsOpen;
    }

    void _toggleRightDrawer()
    {
        _rightDrwerIsOpen = !_rightDrwerIsOpen;
    }

    private void HandleLogout()
    {
        NavigationManager.NavigateTo("account/logout", forceLoad: true);
    }
}